## АСАИ – Тестовое задание – АРМ

### Видео-демонстрация
[Смотреть видео](https://drive.google.com/drive/folders/1TtJNbbFW42P-BxzTxI_rondJUij9RN-t?usp=drive_link) — в начале показан полный функционал в веб-интерфейсе с комментариями, затем разбор ключевых частей кода.

### Кратко о проделанной работе и функционале
- **ARM задачи**: статусы «Готово → В работе → Готово»; ветки «Брак», «Невозможно выполнить» с обязательной причиной.
- **Ограничение на оператора**: не более одной активной задачи одновременно.
- **Учёт времени**: автоматически рассчитывается длительность выполнения; на пользователя копятся часы, выполненные и брак.
- **Менеджерские действия**: возврат задач в «Готово к Работе» только для группы менеджеров.
- **Экспорт показателей**: CSV отчёт по пользователям с процентом брака и часами `GET /asai_arm/export/performance` (доступен менеджерам).
- **Интерфейс Odoo**: меню и формы, Kanban со стабильным порядком колонок, диалоги ввода причины.
- **Тесты**: unit-тесты покрывают основной бизнес-флоу и ограничения.

Уровень сложности: hard.

### Быстрый старт (Docker Compose)
Требуется установленный Docker.

1. Клонируйте репозиторий:
   - `git clone https://github.com/markleontyev/asai-arm.git`
   - `cd asai-arm`
2. Запустите систему:
   - `docker compose up`

Что происходит при запуске:
- Сначала выполняется инициализация и юнит‑тесты модуля (`--test-enable` + `--stop-after-init`). При сбое тестов запуск Odoo не продолжится.
- Затем поднимается сам сервер Odoo на `http://localhost:8069` и подключается база данных.

Остановить:
- `docker compose down`.

Полезно:
- Полностью очистить данные: `docker compose down -v`.

### Доступ, роли и демо-данные
- Веб-интерфейс: `http://localhost:8069`
- Администратор: логин `admin`, пароль `admin` (по умолчанию Odoo). При первом запуске база создаётся автоматически.
- Группы:
  - `АРМ: Оператор` — выполнение задач.
  - `АРМ: Менеджер` — управление и экспорт показателей.
- Демо‑данные задач загружаются автоматически при установке модуля.

### Экспорт показателей (CSV)
- URL: `GET /asai_arm/export/performance`
- Формат: `;`‑разделённый CSV с колонками: Оператор, Выполнено, Брак, Процент брака, Часы.
- Права: доступно группе менеджеров.

### Юнит‑тесты
- Автоматически выполняются при `docker compose up` до старта сервера Odoo.
- Запуск вручную внутри контейнера:
  - `docker compose run --rm odoo bash -lc "odoo -c /etc/odoo/odoo.conf -d ${DB_NAME:-Asai} -u asai_arm --test-enable --stop-after-init"`

### Структура
- `addons/asai_arm/models/arm_task.py` — модель задач и бизнес‑логика действий.
- `addons/asai_arm/models/user_stats.py` — счётчики продуктивности на пользователе.
- `addons/asai_arm/controllers/export.py` — HTTP‑контроллер экспорта CSV.
- `addons/asai_arm/tests/test_task_flow.py` — unit‑тесты флоу и ограничений.
- `addons/asai_arm/views/*` — меню, формы, kanban и диалоги причин.
- `docker-compose.yml` — БД Postgres + Odoo 18; автозапуск тестов перед сервером.
