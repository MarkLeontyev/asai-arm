<odoo>
  <data>
    <record id="view_arm_task_kanban" model="ir.ui.view">
      <field name="name">arm.task.kanban</field>
      <field name="model">arm.task</field>
      <field name="arch" type="xml">
        <kanban default_group_by="state" class="o_kanban_dashboard">
          <field name="name"/>
          <field name="state"/>
          <field name="started_at"/>
          <field name="finished_at"/>
          <field name="operator_ids"/>
          <templates>
            <t t-name="card">
              <div t-attf-class="arm-card oe_kanban_global_click o_kanban_record {{ record.state.raw_value }}">
                <div class="arm-row">
                  <div class="arm-col arm-col-grow">
                    <div class="arm-title" t-esc="record.name.value"/>
                  </div>
                  <div class="arm-col arm-status" t-esc="record.state.value"/>
                </div>
                <div class="arm-actions">
                  <t t-if="record.state.raw_value === 'ready'">
                    <button type="object" name="action_take" class="btn btn-primary">ВЗЯТЬ В РАБОТУ</button>
                  </t>
                  <t t-if="record.state.raw_value === 'in_progress'">
                    <button type="object" name="action_done" class="btn btn-success">ГОТОВО</button>
                  </t>
                  <t t-if="record.state.raw_value !== 'scrap' and record.state.raw_value !== 'done'">
                    <button type="object" name="action_open_scrap_dialog" class="btn btn-danger">БРАК</button>
                  </t>
                </div>
                <div class="arm-secondary">
                  <a type="open" class="btn btn-link" role="button">ПОДРОБНЕЕ</a>
                  <button type="object" name="action_open_attachments" class="btn btn-link">ФАЙЛЫ</button>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>
    <record id="view_arm_task_list" model="ir.ui.view">
      <field name="name">arm.task.list</field>
      <field name="model">arm.task</field>
      <field name="arch" type="xml">
        <list decoration-warning="state == 'in_progress'" decoration-danger="state == 'scrap'" decoration-success="state == 'done'">
          <field name="name"/>
          <field name="state"/>
          <field name="started_at"/>
          <field name="finished_at"/>
          <field name="operator_ids" widget="many2many_tags"/>
          <button name="action_take" type="object" string="Взять в работу"
                  invisible="state != 'ready' or state == 'blocked'"/>
          <button name="action_done" type="object" string="ГОТОВО"
                  invisible="state != 'in_progress'"/>
          <button name="action_open_scrap_dialog" type="object" string="БРАК"
                  invisible="state == 'scrap' or state == 'done'"/>
        </list>
      </field>
    </record>

    <record id="view_arm_task_form" model="ir.ui.view">
      <field name="name">arm.task.form</field>
      <field name="model">arm.task</field>
      <field name="arch" type="xml">
        <form string="Задание">
          <sheet>
            <group>
              <field name="name"/>
              <field name="state" widget="statusbar" statusbar_visible="ready,in_progress,done,scrap,blocked"/>
              <field name="operator_ids" widget="many2many_tags"/>
              <field name="started_at" readonly="1"/>
              <field name="finished_at" readonly="1"/>
              <field name="duration_minutes" readonly="1"/>
              <field name="attachment_ids" widget="many2many_binary"/>
              <field name="scrap_reason" invisible="state != 'scrap'"/>
              <field name="fail_reason" invisible="state != 'blocked'"/>
            </group>
          </sheet>
          <footer>
            <button name="action_take" string="Взять в работу" type="object"
                    invisible="state != 'ready' or state == 'blocked'"/>
            <button name="action_done" string="ГОТОВО" type="object"
                    invisible="state != 'in_progress'"/>
            <button name="action_open_scrap_dialog" string="БРАК" type="object"
                    invisible="state == 'scrap' or state == 'done'"/>
            <button name="action_cannot_perform" string="Невозможно выполнить" type="object"
                    invisible="state in ('done','scrap','blocked')"/>
          </footer>
          <chatter/>
        </form>
      </field>
    </record>

    <record id="view_arm_task_search" model="ir.ui.view">
      <field name="name">arm.task.search</field>
      <field name="model">arm.task</field>
      <field name="arch" type="xml">
        <search>
          <filter name="all" string="Все" domain="[]"/>
          <field name="state"/>
          <field name="operator_ids"/>
        </search>
      </field>
    </record>

    <record id="view_arm_task_reason_dialog" model="ir.ui.view">
      <field name="name">arm.task.reason.dialog</field>
      <field name="model">arm.task</field>
      <field name="arch" type="xml">
        <form string="Укажите причину" create="0" edit="1">
          <group>
            <field name="scrap_reason"/>
            <field name="fail_reason"/>
          </group>
          <footer>
            <button name="action_confirm_reason" type="object" string="Подтвердить" class="btn-primary"/>
            <button string="Отмена" special="cancel"/>
          </footer>
        </form>
      </field>
    </record>
  </data>
</odoo>